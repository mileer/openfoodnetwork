= render 'name_and_timing_form', f: f


%h2 Incoming
%table.exchanges
  %thead
    %tr
      %th Supplier
      %th Products
      %th Fees
      %th.actions
  %tbody{'ng-repeat' => 'exchange in order_cycle.incoming_exchanges'}
    %tr{'class' => "supplier supplier-{{ exchange.enterprise_id }}"}
      = render 'exchange_form', :f => f, :type => 'supplier'
    %tr.products{'ng-show' => 'exchange.showProducts'}
      = render 'exchange_supplied_products_form'

= select_tag :new_supplier_id, options_for_select(order_cycle_producer_enterprise_options), {'ng-model' => 'new_supplier_id'}

= f.submit 'Add supplier', 'ng-click' => 'addSupplier($event)'


%h2 Coordinator
-if current_user.enterprises.include? @order_cycle.coordinator
  = f.label :coordinator_id, 'Coordinator'
  = f.select :coordinator_id, order_cycle_coordinating_enterprise_options, { include_blank: true }, {'ng-model' => 'order_cycle.coordinator_id', 'ofn-on-change' => 'order_cycle.coordinator_fees = []', 'required' => true}
  = render 'coordinator_fees', f: f
- else
  = @order_cycle.coordinator.name

%h2 Outgoing
%table.exchanges
  %thead
    %tr
      %th Distributor
      %th Products
      %th Pickup / Delivery details
      %th Fees
      %th.actions
  %tbody{'ng-repeat' => 'exchange in order_cycle.outgoing_exchanges'}
    %tr{'class' => "distributor distributor-{{ exchange.enterprise_id }}"}
      = render 'exchange_form', :f => f, :type => 'distributor'
    %tr.products{'ng-show' => 'exchange.showProducts'}
      = render 'exchange_distributed_products_form'

= select_tag :new_distributor_id, options_for_select(order_cycle_hub_enterprise_options), {'ng-model' => 'new_distributor_id'}
= f.submit 'Add distributor', 'ng-click' => 'addDistributor($event)'

.actions
  = f.submit @order_cycle.new_record? ? 'Create' : 'Update', 'ng-disabled' => '!loaded()'
  %span{'ng-show' => 'loaded()'}
    or
    = link_to 'Cancel', main_app.admin_order_cycles_path
  %span{'ng-hide' => 'loaded()'} Loading...


- unless Rails.env.production?
  #order-cycles-debug
    %h2 Debug information

    %pre loaded =  {{ loaded() | json }}
    %hr/
    %pre order_cycle = {{ order_cycle | json }}
    %hr/
    %pre enterprises = {{ enterprises | json }}
    %hr/
    %pre enterprise_fees = {{ enterprise_fees | json }}
    %hr/
    %pre supplied_products = {{ supplied_products | json }}
